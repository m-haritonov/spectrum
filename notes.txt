TODO: remove multi-charset support, add config::setInputCharset method (because there are no correct way to get string charset in any place of code and because passing encoding to each place of code is more difficult; see section "charset problem" in notes.txt to details)

TODO: создать Html::escapeHtml($text){ return htmlspecialchars($text, ENT_QUOTES | ENT_HTML401, 'iso-8859-1'); }
TODO: убрать htmlspecialchars из Component::translate, обернуть вызов Component::translate в $this->escapeHtml()

TODO: indention и newline не конвертировать, т.к. они уже в выходной кодировке
TODO: change "$spec->getName()" to "$spec->output->convertToOutputCharset($spec->getName())" in exception messages (or remove $spec->getName() from exception messages)

TODO: mb_*('', 'latin1'|$spec->charset->getInputEncoding()) и т.п.
TODO: добавить в mb_* функции в autoload указание кодировки???

TODO: данные спеки конвертировать в кодировку скрипта (utf 8) или лучше каждую выводимую строчку конвертировать в выходную кодировку (convertToOutputEncodingFromScriptCharset и convertToOutputEncodingFromSpecInputCharset)
TODO: output перенести в драйвер (метод put удалить или перенести в reports плагин)
TODO: reports->put()
TODO: reports->convertToOutputEncoding || charset->convertStringToOutputCharset
TODO: использовать convertToOutputCharset при выводе данных из:
Spec::setName()
Messages::add()
ResultBuffer::addResult()
Output::put('текст')
fail()

TODO: fix encoding
TODO: изменить autoload

TODO: iconv -> mb_convert_encoding

TODO: вынести общую часть из group и test в функцию createSpec
TODO: createDriver -> getDriverOnce???
TODO: перенести testedValue из setTestedValue в setMatcherArguments в MatcherCallDetails???
TODO: config::lock -> deny access from Spec/AssertInterface and builders ???
TODO: remove ownerSpec from resultBuffer???
TODO: 'Error handler in spec "' . $this->getOwnerSpec()->getName() . '" was removed' -> 'Error handler was removed'
TODO: loadBaseMatchers — возвращать массив загруженных матчеров вместо добавления из в передаваемую спеку
TODO: перенести функции setBuildingSpec, getBuildingSpec, getExclusionSpecs, addExclusionSpec в пространство имён internal/storage ???
	или создать объект Storage и билдер getStorageOnce()
	или переименовать функции в функции вида setBuildingSpecInStorage
	или просто сделать функцию getPermanentStorage(), возвращающую \stdClass
	добавить слово current к имени переменных в хранилище
	callFunctionOnBuildingSpec -> callFunctionOnCurrentBuildingSpec
	filterOutExclusionSpecs -> filterOutCurrentExclusionSpecs
	
TODO: isRunningState and getRootSpec to internal
TODO: Spec::getSpecId move to \spectrum\builders\internal\getSpecId (and use it in run($specId, $runInAllContexts = false) function) ??? 
TODO: remove $ownerSpec from ResultBuffer???
TODO: удалить методы config::setXxxClass и все интерфейсы у классов, кроме тех, на которые ссылаются имеющиеся программные сущности ???

TODO: удалить поддержку scalar значений у array контекстов
TODO: добавить поддержку функций в array контекстах: test(array(
	'aaa aaa' => array('a1' => 'aaa'),
	'aaa aaa' => function(){ $this->a1 = 'aaa'; },
), function(){});

TODO: рядом с результатом (серым шрифтом) и в верхнем и нижнем блоке писать кол-во выполненных тестов, время выполнения каждого теста и группы тестов (время выполнения группы вычислять либо путём сложения времени детей либо замерять реальное время выполнения либо писать оба значения либо одно значение писать в title)
TODO: добавить информацию о фреймворке (название, версию и адрес сайта): либо при нажатии на иконку [i] либо в конце нижнего блока totalResult (<a href="http://spectrum-framework.org/">Spectrum 1.0</a>)

TODO: change text "Run results buffer contains" and etc.
TODO: добавить всплывающие подсказки с разъяснениями к элементам ползунка "Details"
TODO: success ("has empty" or "success, has empty")
TODO: плагин "Report": добавить title к резальтату или выводить "success", если есть "success" и "empty" дети
		empty title — "empty or has empty", "all or one of children was empty"
		all specs is "success"
		one or more specs is "fail"
		one or more specs is "empty" and has no "fail"
		
TODO: Показывать в отчетах null для value1 у оператора throws если исключение не выбрасывалось
TODO: вернуть отображение trace в оъектах exception, сделав сворачивание списка/разворачивание элементов дерева
TODO: реализовать проверку *RECURSION* в VariableHierarchical (в элементе массива тоже может содержаться объект)

TODO: create "Reports" test "testGeneratesValidXhtml" (проверяет валидность вёрстки)

TODO: fix reports in all browsers 

TODO: deny "no array" elements in convertArrayWithContextsToSpecs???

TODO: plugin OutputCapture (плюс вывод в отчёте в отдельном блоке с заголовком "Output:" с визуализацией пробельных символов), onEndingSpecExecuteBefore/After or onSpecRunStart/Finish
TODO: matchers: be(function(){})->outputs/prints('aaa a aaaaa ');

TODO: rename contexts->add to addFunction/addApplierFunction/addContextApplier ???
TODO: перенести инициализацию контекстов в плагин "Test"???
TODO: заменить this() передачей аргумента с экземпляром контекста???
TODO: игнорировать пойманные ошибки в случае установки catchPhpErrors в "0" или отображать простам текстом в выводе ???
TODO: добавить setCatchPhpErrors(true/false) ???
TODO: rename setCatchPhpErrors to setErrorLevel/setPhpErrorLevel/setCatchPhpErrorLevel/setCatchingPhpErrorLevel ???
TODO: rename activateMoment to activateType/activationType ???
TODO: ResultBuffer: rename $result['result'] to $result['value/flag'] ???

TODO: проверить методы интерфейсов на соответствие методам класса и наоборот
TODO: написать doc комментарии к методам и функциям (глобальным, расположенным в init.php, в частности)
TODO: проработать тексты сообщений в исключениях (возможно, привести к единому формату вида "function/method name: message")
TODO: исправить грамматические ошибки:
	is deny -> is denied
	IsDeny -> IsDenied
	
TODO: MOVE PROJECT TO GITHUB.COM

TODO: array context group:
	group('aaa', array(
		'Номер мегафон' => array('code' => '495', 'phone' => '35861923'),
		'group: Межгород' => array(
			'Номер мегафон' => array('code' => '495', 'phone' => '35861923'),
			'Номер МТС' => array('code' => '495', 'phone' => '35861923'),
		),
	), function(){
		test('bbb', function(){});
	});

TODO: добавить возможность перевода??? Пример: 
test('Makes something', function(){}, function(){
	// ...
	// ...
	// ...
	// ...
	// ...
}, array(
	'translations/langs' => array(
		'ru' => 'Делает что-либо',
	)
));

или:
translate('Делает что-либо', 'ru');
it('Makes something'), function(){});

установка используемого для отображения языка:
$spec->output/translate->setLanguage('ru');

TODO: создать функцию для автоматической генерации контекстов во всевозможных комбинациях на основе множества значений (предполагаемые названия функции: combine, generate)
TODO: плагин "Report": добавить возможность параллельного сохранения отчёта в файл (report->setWriteToFile())
TODO: run.php
	сделать run.php
	run.php?path=qwe.php&id=spec1_1_1
	возможность указывать путь к файлу или к папке, а так же несколько таких путей
	параметр "show file names":
		линейно (имена файлов выводятся целиком, файлы перечисляются подряд)
		иерархически (для каждой папки создаётся спека с именем этой папки)

TODO: плагин "Report": добавить ссылку "выполнить только этот тест" — в текущем контексте, во всех контекстах

TODO: assert, счетчик вызовов
Command::expectCount();
incrementCount()
count(getRunningInstance()->getResultStack())

=== Documentation ===

TODO: Убрать лишние условия дя примеров, пускай пучше бутлут одни суккесы в результатах
TODO: Убрать из примера files, оставив только базы данных
TODO: Для примеров использовать скриншоты и ссылку на живое выполнение ???
TODO: значения порядка вызова событий от -100 до 100 используются при регистрации базовых плагинов
TODO: заменить "Spectrum is a PHP framework for BDD specification test" на "Spectrum is a PHP framework for test automation"
TODO: поддерживаются кодировки, являющиеся надмножеством ASCII
TODO: на главной закрепить образец использования:
	test('ожидаемый результат', function(){
		// код для проверки ожидаемого результата
	})

=== Multi-charset support problems ===

group(function(){
	before(function(){ $this->aaa = 'text in utf-8'; });
	group(function(){
		before(function(){ $this->bbb = 'text in cp1251'; });
		test(function(){
			// What is result must be added to ResultBuffer (true or false)?
			// How to detect correct charset for output and compare variables?
			be($this->aaa)->eq($this->bbb);
		});
	}, 'cp1251');
}, 'utf-8');

group(function(){
	before(function(){ $this->aaa = 'text in utf-8'; });
	test(function(){
		message($this->aaa); // Now message contains utf-8 text, but test charset is set to cp1251
		message('aaa is: ' . $this->aaa); // Now message contains incorrect string (in mixed charsets)
	}, 'cp1251');
}, 'utf-8');

group(function(){
	before(function(){ \projectName\SomeClass::setText('text in utf-8'); });
	test(function(){
		// What behaviour is expected?
		if (\projectName\SomeClass::getText() != 'text in cp1251')
			fail();
	}, 'cp1251');
}, 'utf-8');

group(function(){
	addMatcher('something', function($text){
		return in_array($text, array('text in utf-8', 'text in utf-8', 'text in utf-8'));
	});
	test(function(){
		// What result is expected (true or false)?
		// Pass charset to matcher function (and to "before/after" functions by analogy)? 
		be('text in cp1251')->something();
	}, 'cp1251');
}, 'utf-8');

group(function(){
	addMatcher('matcherNameInUtf8', function(){});
	test(function(){
		be()->matcherNameInCp1251(); // Is matcher call handling (in "Assert" class) need converting for matcher name?
	}, 'cp1251');
}, 'utf-8');

=== Output and charset ===

	Вопрос: if ($spec->getName() == $name) — перекодировать надо или лучше хранить данные внутри обьектов в UTF-8?
	Ответ:
		Нет, т.к. тогда надо будет перекодировать данные в:
			Spec->setName(),
			SpecContainerPattern->setArguments(),
			SpecContainerPattern->getArguments() — при передаче callback функции в itLikePattern()
			SpecItemIt->setTestCallbackArguments(),
			SpecItemIt->getTestCallbackArguments() — при передаче testCallback функции
		Плюс плагины будут видеть данные world в исходной кодировке, т.к. полностью (включая данные их возможных в нем
		методов) перекодировать его будет проблематично.

		И если внутри кода тестов, написанного в одной кодировке будет вызван один из этих методов, то ему придется
		знать о том, что созданные им данные хранятся в обьектной структуре в другой кодировке и перекодировать.

		Вывод: оставляем хранение данных в обьектной структуре в исходной кодировке, отдавая таким образом предпочтение
		более прозрачной работе с кодировками из тестов, нежели из дополнительных обработчиков вне кода тестов (плагинов,
		кода обработки в runner'е и т.п.)

=== Mocks ===

Spy
FileSystemMockReal
FileSystemMockVirtual

=== Additional matchers ===

TODO: create additional matchers? List:

spectrum_DefaultMatchers_Base_BePhpError(level)

spectrum_DefaultMatchers_File_BeFileExists
spectrum_DefaultMatchers_File_BeFileContentEqual
spectrum_DefaultMatchers_File_BeFileIsDir
spectrum_DefaultMatchers_File_BeFileIsFile
spectrum_DefaultMatchers_File_BeFileIsLink
spectrum_DefaultMatchers_File_BeFileIsExecutable
spectrum_DefaultMatchers_File_BeFileIsReadable
spectrum_DefaultMatchers_File_BeFileIsUploaded
spectrum_DefaultMatchers_File_BeFileIsWritable

spectrum_DefaultMatchers_Array_BeArrayHasKey
spectrum_DefaultMatchers_Array_BeArrayHasValue
spectrum_DefaultMatchers_Array_BeArrayHasAllKeys
spectrum_DefaultMatchers_Array_BeArrayHasAllValues
spectrum_DefaultMatchers_Array_BeArrayHasAnyKey
spectrum_DefaultMatchers_Array_BeArrayHasAnyValue
spectrum_DefaultMatchers_Array_BeArrayUnsortedEqual
spectrum_DefaultMatchers_Array_BeArrayUnsortedEqualRecursive
spectrum_DefaultMatchers_Array_BeArrayUnsortedIdentical
spectrum_DefaultMatchers_Array_BeArrayUnsortedIdenticalRecursive
spectrum_DefaultMatchers_Array_BeArrayCountEqual

spectrum_DefaultMatchers_String_BeStringContain
spectrum_DefaultMatchers_String_BeStringContainInPosition
spectrum_DefaultMatchers_String_BeStringStartWith
spectrum_DefaultMatchers_String_BeStringEndWith
spectrum_DefaultMatchers_File_BeStringEndWithAnySlash
spectrum_DefaultMatchers_File_BeStringStartWithAnySlash

spectrum_DefaultMatchers_RegExp_BePregMatch

spectrum_DefaultMatchers_Xml_BeXmlWellFormed
spectrum_DefaultMatchers_Xml_BeXmlValid

spectrum_DefaultMatchers_Html_BeHtmlAttributeEqual
spectrum_DefaultMatchers_Html_BeHtmlContainTag
spectrum_DefaultMatchers_Html_BeHtmlCorrect
spectrum_DefaultMatchers_Html_BeHtmlWellFormed
spectrum_DefaultMatchers_Html_BeHtmlValid